<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="blockchain ethereun geth,">










<meta name="description" content="安装添加源，安装客户端： apt install software-properties-common add-apt-repository -y ppa:ethereum/ethereum apt install ethereum">
<meta name="keywords" content="blockchain ethereun geth">
<meta property="og:type" content="article">
<meta property="og:title" content="本地运行 geth 记录">
<meta property="og:url" content="http://yoursite.com/2018/03/17/本地运行-geth-记录/index.html">
<meta property="og:site_name" content="Fuyk&#39;s blog">
<meta property="og:description" content="安装添加源，安装客户端： apt install software-properties-common add-apt-repository -y ppa:ethereum/ethereum apt install ethereum">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2019-02-27T16:59:39.327Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="本地运行 geth 记录">
<meta name="twitter:description" content="安装添加源，安装客户端： apt install software-properties-common add-apt-repository -y ppa:ethereum/ethereum apt install ethereum">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2018/03/17/本地运行-geth-记录/">





  <title>本地运行 geth 记录 | Fuyk's blog</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Fuyk's blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/03/17/本地运行-geth-记录/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Fuyk's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">本地运行 geth 记录</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-03-17T16:04:12+08:00">
                2018-03-17
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p>添加源，安装客户端：</p>
<p><code>apt install software-properties-common</code></p>
<p><code>add-apt-repository -y ppa:ethereum/ethereum</code></p>
<p><code>apt install ethereum</code><br><a id="more"></a><br>添加源，安装 solc：</p>
<p><code>add-apt-repository ppa:ethereum/ethereum</code></p>
<p><code>apt update</code></p>
<p><code>apt install solc</code></p>
<h3 id="创世文件"><a href="#创世文件" class="headerlink" title="创世文件"></a>创世文件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	&quot;config&quot;: &#123;</span><br><span class="line">	    &quot;chainId&quot;: 0,</span><br><span class="line">	    &quot;homesteadBlock&quot;: 0,</span><br><span class="line">	    &quot;eip155Block&quot;: 0,</span><br><span class="line">	    &quot;eip158Block&quot;: 0</span><br><span class="line">	&#125;,</span><br><span class="line">	&quot;alloc&quot;      : &#123;&#125;,</span><br><span class="line">	&quot;coinbase&quot;   : &quot;0x0000000000000000000000000000000000000000&quot;,</span><br><span class="line">	&quot;difficulty&quot; : &quot;0x20000&quot;,</span><br><span class="line">	&quot;extraData&quot;  : &quot;&quot;,</span><br><span class="line">	&quot;gasLimit&quot;   : &quot;0x2fefd8&quot;,</span><br><span class="line">	&quot;nonce&quot;      : &quot;0x0000000000000042&quot;,</span><br><span class="line">	&quot;mixhash&quot;    : &quot;0x0000000000000000000000000000000000000000000000000000000000000000&quot;,</span><br><span class="line">	&quot;parentHash&quot; : &quot;0x0000000000000000000000000000000000000000000000000000000000000000&quot;,</span><br><span class="line">	&quot;timestamp&quot;  : &quot;0x00&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><p><code>config</code>中：<br><code>chainId</code> ：<br>​    1. 指定独立的区块链网络 ID。网络 ID 在连接到其他节点的时候会用到，以太坊公网的网络 ID 是 1，为了不与公有链网络冲突，运行私有链节点的时候要指定自己的网络 ID。不同 ID 网络的节点无法相互连接。<a href="https://g2ex.github.io/2017/09/12/ethereum-guidance/" target="_blank" rel="noopener">以太坊私有链搭建指南</a><br>​    2. 标识当前链以及防护重放攻击<a href="https://ethereum.stackexchange.com/questions/15682/the-meaning-specification-of-config-in-genesis-json/15687#15687" target="_blank" rel="noopener">The meaning/specification of “config” in genesis.json</a><br><code>homesteadBlock</code> ：个人私链不会连接进主链，所以设为 0 - your chain won’t be undergoing the switch to Homestead, so leave this as 0. <a href="https://ethereum.stackexchange.com/questions/15682/the-meaning-specification-of-config-in-genesis-json/15687#15687" target="_blank" rel="noopener">The meaning/specification of “config” in genesis.json</a><br><code>eip155Block</code> ：<br><code>eip158Block</code> ： 个人私链不会使用这些改变硬分叉，所以设为 0. - your chain won’t be hard-forking for these changes, so leave as 0.<a href="https://ethereum.stackexchange.com/questions/15682/the-meaning-specification-of-config-in-genesis-json/15687#15687" target="_blank" rel="noopener">The meaning/specification of “config” in genesis.json</a></p>
<p><a href="https://bitshuo.com/topic/5a2bec4a37e357a67e3a34ab" target="_blank" rel="noopener">相关协议机制的升级区块所在的高度，签名算法是homestead -&gt;eip155 -&gt; eip158，所以从homesteadBlock之前区块都通过homestead相关算法机制来验证，homesteadBlock 到 eip155Block之间的用eip155算法来验证，依次类推</a></p>
<p>可根据个人需要自由配置。主链会忽略这部分设置。</p>
</li>
<li><p><a href="https://github.com/ethereum/go-ethereum" target="_blank" rel="noopener">go-ethereum</a>: 上述配置适合于大多数情况，推荐将 <code>nonce</code> 更改为一些随机数，这样可以防止被一些其他可以连接的未知节点连上。可以预置一些账户资金来方便测试，在 <code>alloc</code> 字段中增加账户的配置 ：<br>​<br>“alloc”: {<br>​    “0x0000000000000000000000000000000000000001”: {“balance”: “111111111”},<br>​    “0x0000000000000000000000000000000000000002”: {“balance”: “222222222”}<br>​    }</p>
</li>
<li><p><code>mixhash</code> : 与 <code>nonce</code> 配合用于挖矿，由上一个区块的一部分生成的 <code>hash</code>。此值的设置需要满足以太坊的 <code>Yellow paper, 4.3.4. Block Header Validity, (44)</code> 章节所描述的条件。</p>
</li>
<li><p><code>nonce</code> : 一个 64 位随机数，用于挖矿，此值的设置需要满足以太坊的 <code>Yellow paper, 4.3.4. Block Header Validity, (44)</code>章节所描述的条件。</p>
</li>
<li><p><code>difficulty</code> : 设置当前区块的难度。</p>
</li>
<li><p><code>coinbase</code> : 矿工账号</p>
</li>
<li><p><code>extraData</code> : 附加的信息</p>
</li>
<li><p><code>gasLimit</code> : 该值设置对 <code>GAS</code> 的消耗总量限制，用来限制区块能包含的交易信息总和</p>
</li>
<li><p><code>parentHash</code> : 上一个区块的 <code>hash</code> 值，因为是创世块，所以这个值是 0</p>
</li>
<li><p><code>timestamp</code> : 设置创世块的时间戳</p>
</li>
</ul>
<h3 id="写入创世区块。-修改了配置文件需要重新初始化创世块。"><a href="#写入创世区块。-修改了配置文件需要重新初始化创世块。" class="headerlink" title="写入创世区块。-修改了配置文件需要重新初始化创世块。"></a>写入创世区块。-修改了配置文件需要重新初始化创世块。</h3><p>在创世配置文件同级目录中创建一个新目录用来存放区块链数据。</p>
<p>在创世配置文件同级目录中，执行初始化命令。 <code>geth --datadir data_dir init genesis.json</code>。</p>
<p>(报错：<code>Fatal: invalid genesis file: json: cannot unmarshal hex string of odd length into Go struct field Genesis.extraData of type hexutil.Bytes</code>，原因是从v1.6开始，设置的十六进制数值，不能是奇数位， 比如不能是 <code>0x0</code>，而应该是 <code>0x00</code>。)</p>
<p>成功后数据目录 <code>data_dir</code> 内会有两个目录： <code>geth/chaindata</code> 存放区块数据，<code>keystore</code> 存放账户数据。</p>
<h3 id="启动私有链节点"><a href="#启动私有链节点" class="headerlink" title="启动私有链节点"></a>启动私有链节点</h3><p><code>geth --identity &quot;TestNode&quot; --rpc --rpcport &quot;8545&quot; --datadir data0 --port &quot;30303&quot; --nodiscover console</code></p>
<p>主体命令为 <code>geth console</code>。<code>geth</code> 相关配置选项如下：</p>
<p>使用方法： <code>geth [选项] 命令 [命令选项] [参数]</code></p>
<ul>
<li>命令：<br><code>account</code>        管理账户<br><code>attach</code>          开启一个 <code>JavaScript</code> 的交互环境（连接节点）<br><code>bug</code>              在 <code>geth</code> 包上打开一个窗口来报告一个 <code>bug</code><br><code>console</code>         开启一个 <code>JavaScript</code> 的交互环境<br><code>copydb</code>          从指定的链数据目录创建一个本地链<br><code>dump</code>              另外存储指定的块<br><code>dumpconfig</code>     展示配置值<br><code>export</code>        导出区块链到文件<br><code>import</code>        导入一个区块链文件<br><code>init</code>             引导并初始化一个新的创世区块<br><code>js</code>            执行指定的 <code>JavaScript</code> 文件<br><code>license</code>         展示证书信息<br><code>makecache</code>     生成 <code>ethash</code> 验证缓存（用于测试）<br><code>makedag</code>        生成 <code>ethash</code> 挖矿 <code>DAG</code> (用于测试)<br><code>monitor</code>         监视和可视化节点度量<br><code>removedb</code>        删除区块链和状态数据库<br><code>version</code>        打印版本号<br><code>wallet</code>        管理以太坊预售钱包<br><code>help, h</code>         展示命令列表或者指定命令的帮助信息</li>
<li><code>ethereum</code> 选项：<br><code>--config value</code>                    <code>TOML</code> 配置文件<br><code>--datadir &quot;/path/to/.ethereum&quot;</code>    数据库和账户的数据存储目录<br><code>--keystore</code>                        账户数据存储目录 （<code>default</code> - 默认在 <code>datadir</code> 中）<br><code>--nousb</code>                            禁用监视和管理USB硬件钱包<br><code>--networkid value</code>                    网络标识符（整型，<code>1=Frontier, 2=Morden (disused), 3=Ropsten, 4=Rinkeby</code>) (默认 1)<br><code>--testnet</code>                            <code>Ropsten</code> 网络：预先配置的工作量证明机制的测试网络<br><code>--rinkeby</code>                            <code>Rinkeby</code> 网络：预先配置的权威证明机制的测试网络<br><code>--syncmode &quot;fast&quot;</code>                    区块链同步模式（”fast”,”full”,”light”）<br><code>--ethstats value</code>                    报告 <code>ethstats</code> 服务的 <code>url</code> （节点名称：<code>secret@host:port</code>）<br><code>--identity value</code>                    设置节点名称<br><code>--lightserv value</code>                    允许服务 <code>LES</code> 请求的最大时间百分比（0-90）（默认值：0）<br><code>--lightpeers value</code>                <code>LES</code> 客户端节点的最大值（默认 20）<br><code>--lightkdf</code>                         减少密钥派生内存和CPU使用率的一些 <code>KDF</code> 强度的耗费</li>
<li>开发者的链选项：<br><code>--dev</code>                    采用预先资助的开发人员帐户的临时权威证明网络，挖矿功能开启。<br><code>--dev.period value</code>     在开发人员模式下使用的块周期（0 =仅在事务处于待处理状态时使用）（默认值：0)</li>
<li><code>ethash</code> 选项：<br><code>--ethash.cachedir</code>                        保存 <code>ethash</code> 验证缓存的目录（默认在 <code>datadir</code> 中）<br><code>--ethash.cachesinmem value</code>            保留在内存中的最新ethash缓存数量（每个16MB）（默认值：2）<br><code>--ethash.cachesondisk value</code>            保留在磁盘上的最新ethash缓存数量（每个16MB）（默认值：3）<br><code>--ethash.dagdir &quot;/path/to/.ethash&quot;</code>    存储 <code>ethash</code> 挖矿的 <code>DAG</code> 的目录（默认在用户目录内）<br><code>--ethash.dagsinmem value</code>                内存中最近使用的 <code>ethash</code> 挖矿 <code>DAG</code> 的数量（每个 1 GB多）（默认值：1）<br><code>--ethash.dagsondisk value</code>             硬盘中最近使用的 <code>ethash</code> 挖矿 <code>DAG</code> 的数量（每个 1 GB多）（默认值：2)</li>
<li>交易池选项：<br><code>--txpool.nolocals</code>                        禁止本地提交的交易价格豁免（？？？）<br><code>--txpool.journal value</code>                节点重新启动时要使用到的本地事务的磁盘日志（默认值：“transactions.rlp”）<br><code>--txpool.rejournal value</code>                重新生成本地事务日志的时间间隔（默认值：1h0m0s）<br><code>--txpool.pricelimit value</code>                被交易池所接受的最小 <code>gas</code> 限制（默认 1）<br><code>--txpool.pricebump value</code>                价格颠簸百分比替换已经存在的交易（默认值：10）(???)<br><code>--txpool.accountslots value</code>            每个账户保证可执行交易时间的最小数量（默认值：16）<br><code>--txpool.globalslots value</code>            所有帐户的可执行事务处理槽的最大数量（默认：4096）<br><code>--txpool.accountqueue value</code>            每个帐户允许的最大不可执行事务处理槽数（默认值：64）<br><code>--txpool.globalqueue value</code>            所有帐户允许的最大不可执行事务处理槽数（默认值：64）<br><code>--txpool.lifetime value</code>                不可执行事务排队的最长时间（默认值：3h0m0s）</li>
<li>性能调整选项：<br><code>--cache value</code>                兆字节的内存分配（最小16MB /数据库强制）（默认值：128）<br><code>--trie-cache-gens value</code>    保留在内存中的节点代数（默认值：120）</li>
<li>账户选项<br><code>--unlock value</code>            解锁以逗号分隔的帐户列表<br><code>--password value</code>            用来非交互密码输入的密码文件</li>
<li>API 和 控制台 选项：<br><code>--rpc</code>                     开启 <code>HTTP-RPC</code> 服务器<br><code>--rpcaddr value</code>        <code>HTTP-RPC</code> 服务器监听的地址（默认：<code>localhost</code>）<br><code>--rpcport value</code>        <code>HTTP-RPC</code> 服务器监听的端口（默认：8545）<br><code>--rpcapi value</code>        通过 <code>HTTP-RPC</code> 接口提供的 <code>API</code><br><code>--ws</code>                    开启 <code>WS-RPC</code> 服务器<br><code>--wsaddr value</code>        <code>WS-RPC</code> 服务器监听的地址（默认：<code>localhost</code>）<br><code>--wsport value</code>        <code>WS-RPC</code> 服务器监听的端口（默认：8546）<br><code>--wsapi value</code>            通过 <code>WS-RPC</code> 接口提供的 <code>API</code><br><code>--wsorigins value</code>        接受 <code>websockets</code> 请求的来源<br><code>--ipcdisable</code>            关闭 <code>IPC-RPC</code> 服务器<br><code>--ipcpath</code>                在 <code>datadir</code> 内的 <code>IPC socket/pipe</code> 文件名<br><code>--rpccorsdomain value</code> 以逗号分隔的接受跨源请求的域列表（浏览器强制执行）<br><code>--jspath loadScript</code>    加载脚本的 <code>JavaScript</code> 根目录（默认 : ‘.’）<br><code>--exec value</code>            执行 <code>JavaScript</code> 语句<br><code>--preload value</code>        预加载到控制台中以逗号分隔的 <code>JavaScript</code> 文件列表</li>
<li>网络选项<br><code>--bootnodes value</code>        用于 <code>P2P</code> 发现引导的逗号分隔的 <code>enode URL</code>（为轻服务器设置v4 + v5）<br><code>--bootnodesv4 value</code>    用于 <code>P2P v4</code> 发现引导程序的逗号分隔 <code>enode URL</code>（轻服务器，完整节点）<br><code>--bootnodesv5 value</code>    用于 <code>P2P v5</code> 发现引导的逗号分隔的 <code>enode URL</code>（轻服务器，轻节点）<br><code>--port value</code>            网络监听端口号（默认 30303）<br><code>--maxpeers value</code>        网络节点的最大数量（如果设为 0，则关闭网络连接）（默认 25）<br><code>--maxpendpeers value</code>    最大数量的挂起连接尝试（如果设为 0，使用默认值）（默认 0）<br><code>--nat value</code>            <code>NAT</code> 端口映射机制（<code>any | none | upnp | pmp | extip：&lt;IP&gt;</code>）（默认值：“any”）<br><code>--nodiscover</code>            关闭节点发现机制（手动添加节点）<br><code>--v5disc</code>                启用实验性RLPx V5（主题发现）机制<br><code>--netrestrict value</code>    将网络通信限制在给定的IP网络（CIDR掩码）<br><code>--nodekey value</code>        <code>P2P</code> 节点键文件<br><code>--nodekeyhex value</code>    <code>P2P</code> 节点 16 进制键（测试）</li>
<li>挖矿选项<br><code>--mine</code>                    开启挖矿<br><code>--minerthreads value</code>        用来挖矿的 <code>CPU</code> 数量（默认 1）<br><code>--etherbase value</code>            块挖掘奖励的公开地址（默认=创建的第一个帐户）（默认值：“0”）<br><code>--targetgaslimit value</code>     手动设置挖矿的区块的 <code>gas</code> 下限<br><code>--gasprice &quot;18000000000&quot;</code>    挖矿打包交易的最小 <code>gas</code> 价格<br><code>--extradata value</code>            矿工对区块设置的额外数据（默认是客户端版本）</li>
<li><code>gas price</code> 预设选项：<br><code>--gpoblocks value</code>            最近检测 <code>gas prices</code> 的区块数（默认是 10）<br><code>--gpopercentile value</code>        <code>gas price</code> 的推荐值是最近交易的 <code>gas price</code> 的一个集合的百分比</li>
<li>虚拟机选项：<br><code>--vmdebug</code>    记录对虚拟机和合约调试有用的信息</li>
<li>日志和调试选项<br><code>--metrics</code>                    开启指标收集和报告<br><code>--fakepow</code>                    关闭工作量证明验证<br><code>--nocompaction</code>            导入后禁用数据库压缩<br><code>--verbosity value</code>            记录详细程度：0 =静默，1 =错误，2 =警告，3 =信息，4 =调试，5 =详细信息（默认值：3）<br><code>--vmodule value</code>            每个模块的详细程度：以逗号分隔的 <code>&lt;pattern&gt; = &lt;level&gt;</code> 列表（例如<code>eth / * = 5，p2p = 4</code>）<br><code>--backtrace value</code>            在特定的日志语句处请求堆栈跟踪（例如“block.go：271”）<br><code>--debug</code>                    在被调用站点的位置（文件和行号）前加上日志消息<br><code>--pprof</code>                    开启 <code>pprof HTTP</code> 服务器<br><code>--pprofaddr value</code>            <code>pprof HTTP</code> 服务器监听接口（默认：<code>127.0.0.1</code>）<br><code>--pprofport value</code>            <code>pprof HTTP</code> 服务器监听端口（默认6060）<br><code>--memprofilerate value</code>    以给定速率打开内存分析（默认值：524288）<br><code>--blockprofilerate value</code>    以给定的速率打开块分析（默认值：0）<br><code>--cpuprofile value</code>        将 <code>CPU</code> 的分析写入给定的文件<br><code>--trace value</code>                将执行跟踪写入给定的文件</li>
<li><code>whisper</code> (实验)选项：<br><code>--shh</code>                            开启 <code>whisper</code><br><code>--shh.maxmessagesize value</code>    最大接收消息大小（默认：1048576）<br><code>--shh.pow value</code>                最小 <code>POW</code> 接受值（默认：0.2）</li>
<li>废弃选项：<br><code>--fast</code>     开启通过状态下载来快速同步的功能<br><code>--light</code>    开启轻客户端模式</li>
<li><code>misc</code> 选项：<br><code>help, -h</code> 显示帮助</li>
</ul>
<h3 id="控制台操作"><a href="#控制台操作" class="headerlink" title="控制台操作"></a>控制台操作</h3><p>常用命令：</p>
<ul>
<li><code>personal.newAccount()</code>:创建账户；</li>
<li><code>personal.unlockAccout()</code>:解锁账户；</li>
<li><code>eth.accounts</code>：枚举系统中的账户；</li>
<li><code>eth.getBalance()</code>：查看账户余额，返回值的单位是 <code>Wei</code>（<code>Wei</code> 是以太坊中最小货币面额单位，类似比特币中的聪，<code>1 ether = 10^18 Wei</code>）；</li>
<li><code>eth.blockNumber</code>：列出区块总数；</li>
<li><code>eth.getTransaction()</code>：获取交易；</li>
<li><code>eth.getBlock()</code>：获取区块；</li>
<li><code>miner.start()</code>：开始挖矿；</li>
<li><code>miner.stop()</code>：停止挖矿；</li>
<li><code>web3.fromWei()</code>：<code>Wei</code> 换算成以太币；</li>
<li><code>web3.toWei()</code>：以太币换算成 <code>Wei</code>；</li>
<li><code>txpool.status</code>：交易池中的状态；</li>
<li><code>admin.addPeer()</code>：连接到其他节点；</li>
<li><code>personal</code><ol>
<li><code>properties</code>:<br>1.1 <code>listAccounts</code>:账户列表<br>2.2 <code>listWallets</code>: 钱包列表<br>​    <code>accounts</code>：账户<br>​    <code>status</code>：状态<br>​    <code>url</code>：位置</li>
<li><code>functions</code>:<br>2.1 <code>deriveAccount : function()</code><br>2.2 <code>ecRecover : function()</code><br>2.3 <code>getListAccounts ：function(callback)</code> 获取账户列表<br>2.4 <code>getListWallets ：function(callback)</code> 获取钱包列表<br>2.5<code>importRawKey : function(callback)</code><br>2.6 <code>lockAccount ：function(callback)</code> 账户加锁<br>2.7 <code>newAccount ：function github.com/ethereum/go-ethereum/console.(*bridge).NewAccount-fm()</code> 账户创建<br>2.8<code>openWallet ：function github.com/ethereum/go-ethereum/console.(*bridge).OpenWallet-fm()</code><br>2.9 <code>sendTransaction ：function()</code> 发送交易<br>3.0 <code>sign ：function github.com/ethereum/go-ethereum/console.(*bridge).Sign-fm()</code> 签名<br>3.1 <code>unlockAccount ：function github.com/ethereum/go-ethereum/console.(*bridge).UnlockAccount-fm()</code> 账户解锁</li>
</ol>
</li>
<li>eth<br>1.1 accounts ： 账户<br>1.2 blockNumber ： 区块数<br>1.3 coinbase ： 挖矿所得账户<br>1.4 compile :<br>​        funciton:<br>​        lll : function()<br>​        serpent : function()<br>​        solidity : function()<br>1.5 defaultAccount ： 默认账户<br>1.6 defaultBlock: 默认区块<br>1.7 gasPrice ： 燃料价格<br>1.8 hashrate ：<br>1.9 mining ：<br>1.10 pendingTransactions ： 本地的以太坊节点拥有，并没有被打包入区块存储的交易，<br>1.11 protocolVersion :<br>1.12 syncing :<br>1.13 call : function()<br>1.14 contract : function(abi)<br>1.15 estimateGas : function()<br>1.16 filter : function(options, callback, filterCreationErrorCallback)<br>1.17 getAccounts: function(callback) 获取账户<br>1.18 getBalance: function(),<br>1.19 getBlock: function(),<br>1.20 getBlockNumber: function(callback),<br>1.21 getBlockTransactionCount: function(),<br>1.22 getBlockUncleCount: function(),<br>1.23 getCode: function(),<br>1.24 getCoinbase: function(callback),<br>1.25 getCompilers: function(),<br>1.26 getGasPrice: function(callback),<br>1.27 getHashrate: function(callback),<br>1.28 getMining: function(callback),<br>1.29 getPendingTransactions: function(callback),<br>1.30 getProtocolVersion: function(callback),<br>1.31 getRawTransaction: function(),<br>1.32 getRawTransactionFromBlock: function(),<br>1.33 getStorageAt: function(),<br>1.34 getSyncing: function(callback),<br>1.35 getTransaction: function(),<br>1.36 getTransactionCount: function(),<br>1.37 getTransactionFromBlock: function(),<br>1.38 getTransactionReceipt: function(),<br>1.39 getUncle: function(),<br>1.40 getWork: function(),<br>1.41 iban: function(iban),<br>1.42 icapNamereg: function(),<br>1.43 isSyncing: function(callback),<br>1.44 namereg: function(),<br>1.45 resend: function(),<br>1.46 sendIBANTransaction: function(),<br>1.47 sendRawTransaction: function(),<br>1.48 sendTransaction: function(),<br>1.49 sign: function(),<br>1.50 signTransaction: function(),<br>1.51 submitTransaction: function(),<br>1.52 submitWork: function()</li>
<li>miner<br>1.1  getHashrate: function(),<br>1.2     setEtherbase: function(),<br>1.3  setExtra: function(),<br>1.4     setGasPrice: function(),<br>1.5     start: function() 开启挖矿<br>1.6     stop: function() 停止挖矿</li>
<li>txpool<br>1.1 content:<br>​        pending:<br>​        queued:<br>1.2 inspect:<br>​        pending:<br>​        queued:<br>1.3 status:<br>​        pending:<br>​        queued:<br>1.4 getContent:function(callback)<br>1.5 getInspect:function(callback)<br>1.6 getStatus:function(callback)</li>
<li>admin<br>1.1 datadir: 区块链存储的目录<br>1.2 nodeInfo: 节点信息<br>​        enode: 被其他节点连接时用到的标识符，格式为 “enode://[id]@[ip]:[port]?param=value”<br>​        id: 节点唯一标识符<br>​        ip: 节点 ip<br>​        listenAddr: 节点监听的地址 “[ip]:[port]”<br>​        name: 节点名称<br>​        ports:<br>​            discovery: 是否允许被其他可连接的节点发现<br>​            listener: 监听的端口<br>​        protocols:<br>​            eth:<br>​                difficulty: 挖矿难度<br>​                genesis:<br>​                head<br>​                network<br>1.3 peers: 连接上的节点列表<br>1.4 addPeer: function() 添加节点<br>1.5 exportChain: function(),<br>1.6    getDatadir: function(callback),<br>1.7    getNodeInfo: function(callback),<br>1.8    getPeers: function(callback),<br>1.9    importChain: function(),<br>1.10 removePeer: function(),<br>1.11 sleep: <code>function github.com/ethereum/go-ethereum/console.(*bridge).Sleep-fm()</code>,<br>1.12 sleepBlocks: <code>function github.com/ethereum/go-ethereum/console.(*bridge).SleepBlocks-fm()</code> 在挖出指定数目的区块后停止<br>1.13 startRPC: function(),<br>1.14 startWS: function(),<br>1.15 stopRPC: function(),<br>1.16 stopWS: function()</li>
<li>web3<br>1.1 admin<br>1.2 bzz:<br>​        hive:<br>​        info:<br>​        blockNetworkRead: function(),<br>​        download: function(),<br>​        get: function(),<br>​        getHive: function(callback),<br>​        getInfo: function(callback),<br>​        modify: function(),<br>​        put: function(),<br>​        retrieve: function(),<br>​        store: function(),<br>​        swapEnabled: function(),<br>​        syncEnabled: function(),<br>​        upload: function()<br>1.3 currentProvider:<br>​        newAccount: function(),<br>​        openWallet: function(),<br>​        send: <code>function github.com/ethereum/go-ethereum/console.(*bridge).Send-fm()</code>,<br>​        sendAsync: <code>function github.com/ethereum/go-ethereum/console.(*bridge).Send-fm()</code>,<br>​        sign: function(),<br>​        unlockAccount: function()<br>1.4 db:<br>​        getHex: function(),<br>​        getString: function(),<br>​        putHex: function(),<br>​        putString: function()<br>1.5 debug:<br>​        backtraceAt: function(),<br>​        blockProfile: function(),<br>​        chaindbCompact: function(),<br>​        chaindbProperty: function(),<br>​        cpuProfile: function(),<br>​        dumpBlock: function(),<br>​        freeOSMemory: function(),<br>​        gcStats: function(),<br>​        getBadBlocks: function(),<br>​        getBlockRlp: function(),<br>​        getModifiedAccountsByHash: function(),<br>​        getModifiedAccountsByNumber: function(),<br>​        goTrace: function(),<br>​        memStats: function(),<br>​        metrics: function(),<br>​        preimage: function(),<br>​        printBlock: function(),<br>​        seedHash: function(),<br>​        setBlockProfileRate: function(),<br>​        setGCPercent: function(),<br>​        setHead: function(),<br>​        stacks: function(),<br>​        startCPUProfile: function(),<br>​        startGoTrace: function(),<br>​        stopCPUProfile: function(),<br>​        stopGoTrace: function(),<br>​        storageRangeAt: function(),<br>​        traceBlock: function(),<br>​        traceBlockByHash: function(),<br>​        traceBlockByNumber: function(),<br>​        traceBlockFromFile: function(),<br>​        traceTransaction: function(),<br>​        verbosity: function(),<br>​        vmodule: function(),<br>​        writeBlockProfile: function(),<br>​        writeMemProfile: function()<br>1.6 eth<br>1.7 isIBAN<br>1.8 miner<br>1.9 net<br>​        listening: true,<br>​        peerCount: 已连接的节点数量<br>​        version: “1”,<br>​        getListening: function(callback),<br>​        getPeerCount: function(callback),<br>​        getVersion: function(callback)<br>1.10 personal<br>1.11 providers:<br>​        HttpProvider: function(host, timeout, user, password),<pre><code>IpcProvider: function(path, net)
</code></pre>  1.12 rpc:<pre><code>modules:
    admin: &quot;1.0&quot;,
</code></pre>​            debug: “1.0”,<br>​            eth: “1.0”,<br>​            miner: “1.0”,<br>​            net: “1.0”,<br>​            personal: “1.0”,<br>​            rpc: “1.0”,<br>​            txpool: “1.0”,<br>​            web3: “1.0”<br>​        getModules:  function(callback)<br>1.13 settings:<br>​        defaultAccount: <pre><code>defaultBlock: 
</code></pre>  1.14 shh:<br>​        addPrivateKey: function(),<br>​        addSymKey: function(),<br>​        deleteKeyPair: function(),<br>​        deleteSymKey: function(),<br>​        generateSymKeyFromPassword: function(),<br>​        getPrivateKey: function(),<br>​        getPublicKey: function(),<br>​        getSymKey: function(),<br>​        hasKeyPair: function(),<br>​        hasSymKey: function(),<br>​        info: function(),<br>​        markTrustedPeer: function(),<br>​        newKeyPair: function(),<br>​        newMessageFilter: function(options, callback, filterCreationErrorCallback),<br>​        newSymKey: function(),<br>​        post: function(),<br>​        setMaxMessageSize: function(),<br>​        setMinPoW: function(),<br>​        version: function()<br>1.15 txpool<br>1.16 version:<br>​        api: “0.20.1”,<br>​        ethereum: “0x3f”,<br>​        network: “1”,<br>​        node: “Geth/TestNode/v1.7.3-stable-4bb3c89d/linux-amd64/go1.9”,<br>​        whisper: undefined,<br>​        getEthereum: function(callback),<br>​        getNetwork: function(callback),<br>​        getNode: function(callback),<br>​        getWhisper: function(callback)<br>1.17 BigNumber: function a(e,n),<br>1.18 createBatch: function(),<br>1.19 fromAscii: function(str),<br>1.20 fromDecimal: function(value),<br>1.21 fromICAP: function(icap),<br>1.22 fromUtf8: function(str),<br>1.23 fromWei: function(number, unit) Wei转换成以太币<br>1.24 isAddress: function(address),<br>1.25 isChecksumAddress: function(address),<br>1.26 isConnected: function(),<br>1.27 padLeft: function(string, chars, sign),<br>1.28 padRight: function(string, chars, sign),<br>1.29 reset: function(keepIsSyncing),<br>1.30 setProvider: function(provider),<br>1.31 sha3: function(string, options),<br>1.32 toAscii: function(hex),<br>1.33 toBigNumber: function(number),<br>1.34 toChecksumAddress: function(address),<br>1.35 toDecimal: function(value),<br>1.36 toHex: function(val), 转换成 16 进制<br>1.37 toUtf8: function(hex), 16 进制转换成 utf8<br>1.38 toWei: function(number, unit) 以太币转换成 Wei</li>
</ul>
<h4 id="创建账户"><a href="#创建账户" class="headerlink" title="创建账户"></a>创建账户</h4><p><code>personal.newAccount()</code></p>
<h4 id="获取账户列表中第一个账户的资产"><a href="#获取账户列表中第一个账户的资产" class="headerlink" title="获取账户列表中第一个账户的资产"></a>获取账户列表中第一个账户的资产</h4><p><code>eth.getBalance(eth.accounts[0])</code></p>
<h4 id="启动-停止挖矿"><a href="#启动-停止挖矿" class="headerlink" title="启动 / 停止挖矿"></a>启动 / 停止挖矿</h4><p><code>miner.start() / miner.stop()</code></p>
<p>在第一次开启挖矿时，首先会生成 DAG 文件。生成完毕后会开始挖矿。</p>
<p>挖矿收入自动进入矿工账户 <code>coinbase</code>，默认情况该账户是本地账户中的第一个账户，也可以通过 <code>miner.setEtherbase()</code> 手动设置</p>
<h4 id="转账"><a href="#转账" class="headerlink" title="转账"></a>转账</h4><p><code>personal.unlockAccount(eth.accounts[0])</code> 解锁要转出资产的账户</p>
<p><code>eth.sendTransaction({from:eth.accounts[0],to:eth.accounts[1],value:web3.toWei(5,&#39;ether&#39;)})</code>从第一个账户转账到第二个账户 5 个以太坊</p>
<p>交易会保存在本地交易池 <code>txpool</code> 中，用 <code>txpool.status</code> 命令可以看到本地交易池中有一个待确认的交易。</p>
<blockquote>
<p><code>eth.pendingTransactions</code> VS <code>eth.getBlock(&#39;pending&#39;).transactions</code></p>
<p>添加一个合约之后，<code>eth.pendingTransactions</code> 内有数据，<code>eth.getBlock(&#39;pending&#39;).transactions</code> 返回 <code>[]</code>。</p>
<p><code>eth.pendingTransactions</code> are the transactions that your local Geth node has, that haven’t been mined to a block.<br><code>eth.pendingTransactions</code> 是本地的以太坊节点拥有的交易，并没有被打包入区块存储。</p>
<p><code>eth.getBlock(&#39;pending&#39;)</code> is the current block your node is mining (or would be mining on). It is not a block that has been added to the blockchain.  <code>eth.getBlock(&#39;pending&#39;).transactions</code> are the transactions that are included in this hypothetical block.<br><code>eth.getBlock(&#39;pending&#39;)</code> 是你当前真正挖的区块。这是还未被添加入区块链的区块。<code>eth.getBlock(&#39;pending&#39;).transactions</code> 是被包含在一个假想的区块内的交易。<br>If you are sending a transaction, you will see it first in eth.pendingTransactions, before a miner includes it in a block.<br>如果你发起了一笔交易，你首先在 <code>eth.pendingTransactions</code> 内看到，然后是被挖掘除的新区块内。</p>
</blockquote>
<p>等待新区块挖出，该交易会被打包入该区块中。转账的两个账户的资产更新。</p>
<h3 id="查看交易"><a href="#查看交易" class="headerlink" title="查看交易"></a>查看交易</h3><p>通过交易 Hash 查看交易（Hash 值包含在上面交易返回值中）：<code>eth.getTransaction(&quot;hash&quot;)</code></p>
<h3 id="查看区块"><a href="#查看区块" class="headerlink" title="查看区块"></a>查看区块</h3><p>通过区块号查看区块：<code>eth.getBlock(4)</code></p>
<h3 id="连接其他节点"><a href="#连接其他节点" class="headerlink" title="连接其他节点"></a>连接其他节点</h3><p>同一个链中，即 <code>chainId</code> 相同，可以通过 <code>admin.addPeer()</code> 方法连接到其他节点。</p>
<p>通过 <code>admin.nodeInfo.enode</code> 获取一个节点的 <code>enode</code>。在另一个节点 <code>admin.addPeer(&quot;[刚刚获取的enode]&quot;)</code>。需要将 <code>enode</code> 中的 <code>ip</code> 替换成该节点的 <code>ip</code>，如果是同一台电脑，则不用修改。</p>
<p>通过 <code>admin.peers</code> 查看连接到的其他节点信息。</p>
<h3 id="智能合约"><a href="#智能合约" class="headerlink" title="智能合约"></a>智能合约</h3><p>合约就是一段算法，代码，可执行的脚本。</p>
<h4 id="创建和编译智能合约"><a href="#创建和编译智能合约" class="headerlink" title="创建和编译智能合约"></a>创建和编译智能合约</h4><ol>
<li><p>写一个合约脚本。</p>
</li>
<li><p><code>solc --bin contractFile.sol</code> 编译该合约获得 <code>EVM</code> 二进制码 <code>code</code>。</p>
</li>
<li><p><code>solc --abi contractFile.sol</code> 获得合约接口 <a href="https://bitshuo.com/topic/594a8c228e822fcb444317ec" target="_blank" rel="noopener"><code>abi</code></a>。</p>
</li>
<li><p>在 <code>geth</code> 控制台 </p>
<p>code = “0x[上面获得的 code]”<br>abi = [上面获得的 abi]d</p>
</li>
</ol>
<h4 id="部署智能合约"><a href="#部署智能合约" class="headerlink" title="部署智能合约"></a>部署智能合约</h4><ol>
<li><code>personal.unlockAccount(eth.accounts[0])</code> 解锁部署时用到的账户</li>
<li><code>contract = eth.contract(abi).new({from:eth.accounts[0],data:code,gas:1000000})</code> 发送部署合约的交易（可以直接通过 sendTransaction()部署合约：<code>eth.sendTransaction({from:eth.accounts[0],data:code})</code>）</li>
<li>可在本地交易池中查看到该交易。等待新区块出现，该交易会被确认打包，进入新区块。</li>
</ol>
<ul>
<li>如果智能合约有构造函数，在部署时需要传入初始值，<code>contact = eth.contract(abi).new(arg1, arg2, ...,{from: eth.accounts[0], data: evmCode})</code>。<a href="https://ethereum.gitbooks.io/frontier-guide/content/creating_contract.html" target="_blank" rel="noopener">Creating and deploying a contract</a></li>
</ul>
<h4 id="调用智能合约"><a href="#调用智能合约" class="headerlink" title="调用智能合约"></a>调用智能合约</h4><p><code>contract.[合约中的方法名称].sendTransaction([合约中方法对应的参数,..], {from:[消耗燃料的账户,就是谁调用了这个合约]})</code></p>
<h4 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h4><p>智能合约就是一段部署到以太坊上的代码。部署的时候消耗以太币，调用的时候也消耗以太币。</p>
<h3 id="智能合约例子-投票选举"><a href="#智能合约例子-投票选举" class="headerlink" title="智能合约例子 - 投票选举"></a>智能合约例子 - 投票选举</h3><h4 id="创建合约脚本文件"><a href="#创建合约脚本文件" class="headerlink" title="创建合约脚本文件"></a>创建合约脚本文件</h4><p><a href="https://gist.github.com/luren5/84e531e75392765efbb7fde250d6c315" target="_blank" rel="noopener">例子代码来源</a></p>
<h4 id="部署合约"><a href="#部署合约" class="headerlink" title="部署合约"></a>部署合约</h4><ol>
<li><code>solc --bin Ballot.sol</code> 获得编译后的二进制码 <code>code</code></li>
<li><code>solc --abi Ballot.sol</code> 获得合约的 <code>json abi</code> （<code>Application Binary Interface</code> 应用二进制接口）<code>abi</code></li>
<li><code>geth --identity &#39;NodeName&#39; --datadir datadir --... console</code> 进入控制台</li>
<li><code>code = &quot;0xcode&quot;</code> 右侧的 <code>code</code> 为第一步的 <code>code</code></li>
<li><code>abi = abi</code> 右侧的 <code>abi</code> 为第二部的 <code>abi</code></li>
<li><code>personal.unlockAccount(eth.accounts[0])</code> 解锁部署时要用到的账户，这里使用第一个账户</li>
<li><code>Ballot = eth.contract(abi)</code> 创建一个合约实例</li>
<li><code>myBallot = Ballot.new([&#39;f&#39;,&#39;y&#39;,&#39;k&#39;],{from:eth.account[0],data:code,gas:1000000})</code> 提交合约交易。<code>[&#39;f&#39;,&#39;y&#39;,&#39;k&#39;]</code>这个数组是合约的构造方法需要的数据。<a href="https://ethereum.gitbooks.io/frontier-guide/content/creating_contract.html" target="_blank" rel="noopener">语法</a></li>
<li><code>txpool.status</code> 中 <code>pending：1</code></li>
<li><code>miner.start()</code> 挖矿出块，合约被部署到区块链上了</li>
<li><code>personal.newAccount()</code> 创建几个新的账户</li>
<li><code>eth.sendTransaction({from:eth.accounts[0],to:eth.accounts[i],value:web3.toWei(1,&#39;ether&#39;)})</code> 转一些资产到刚刚新创建的账户中。挖矿出块，资产转移成功。</li>
<li><code>myBallot.giveRightToVoter.sendTransaction(eth.account[i],&#39;name&#39;,{from:eth.accounts[0]})</code> 投票由第一个账户发起，所以是主持人。这里将之前创建的新账户赋予投票权，名字。挖矿出块，交易部署到区块链上。</li>
<li><code>myBallot.vote.sendTransaction(i,{from:eth.accounts[j],gas:470000})</code> 第 j 个账户投票给第 i+1 个人。因为索引是从 0 开始。挖矿出块。投票成功。投票前要对相应的账户进行解锁。包括上面赋权的操作，每一笔交易都需要对相应的账户解锁。</li>
<li><code>myBallot.voters(eth.account[i]);web3.toUtf8(&#39;namebin&#39;)</code> 获得第 i+1 个投票人的信息。将投票人的姓名的 16 进制字符串通过 <code>web3.toUtf8(&#39;namebin&#39;)</code> 来转换，可以看到姓名。</li>
<li><code>myBallot.winnerName.call();web3.toUtf8(&#39;namebin&#39;)</code> 可以看到获胜者的姓名</li>
<li><code>myBallot.proposals(i); web3.toUtf8(&#39;bin&#39;)</code> 可以看到被选举人的姓名，和票数</li>
</ol>
<h4 id="FAQ"><a href="#FAQ" class="headerlink" title="FAQ"></a>FAQ</h4><ol>
<li><code>Ballot</code> 和 <code>myBallot</code> 的差别（<code>eth.contract()</code> 和 <code>eth.contract.new()</code>）</li>
</ol>
<p><a href="http://web3.tryblockchain.org/Web3.js-api-refrence.html#toc_51" target="_blank" rel="noopener">web3.eth.contract(abiArray)</a></p>
<p>创建一个Solidity的合约对象，可以被用来在某个地址上初始化合约。</p>
<p>参数：</p>
<p>Array - 一到多个描述合约的函数，事件的ABI对象。<br>返回值：</p>
<p>Object - 一个合约对象。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">// 创建一个合约对象</span><br><span class="line">var MyContract = web3.eth.contract(abiArray);</span><br><span class="line"></span><br><span class="line">// instantiate by address 在指定地址上初始化该对象</span><br><span class="line">var contractInstance = MyContract.at([address]);</span><br><span class="line"></span><br><span class="line">// deploy new contract 部署一个新合约</span><br><span class="line">var contractInstance = MyContract.new([contructorParam1] [, contructorParam2], &#123;data: &apos;0x12345...&apos;, from: myAccount, gas: 1000000&#125;);</span><br><span class="line"></span><br><span class="line">// Get the data to deploy the contract manually 获取数据用来手动部署合约</span><br><span class="line">var contractData = MyContract.new.getData([contructorParam1] [, contructorParam2], &#123;data: &apos;0x12345...&apos;&#125;);</span><br><span class="line">// contractData = &apos;0x12345643213456000000000023434234&apos;</span><br></pre></td></tr></table></figure>
<p>a = eth.contract(abi) 是实例化一个合约对象。查看 a 可以看到它是一个合约的对象，也就是此时只与创建它时的 <code>abi</code> 相关（相当于创建了一个合约模版，包含了上链相关的操作方法，但还是存在于本地），而它的方法列表中则有两个方法：<code>at: function(address, callback)</code>/ <code>new: function()</code> 。<code>at()</code> 就是在指定的地址上实例化该合约对象，应该是相当于取得已部署的一个合约。而 <code>new()</code> 则是部署一个新合约，在部署完毕之后，会返回</p>
<ol start="2">
<li>何时使用 <code>gas</code><br><code>web3.eth.sendTransaction(transactionObject [, callback])</code><br>发送一个交易到网络。<br>参数：</li>
</ol>
<ul>
<li>Object - 要发送的交易对象。</li>
<li>from: String - 指定的发送者的地址。如果不指定，使用web3.eth.defaultAccount。</li>
<li>to: String - （可选）交易消息的目标地址，如果是合约创建，则不填.</li>
<li>value: Number|String|BigNumber - （可选）交易携带的货币量，以wei为单位。如果合约创建交易，则为初始的基金。</li>
<li>gas: Number|String|BigNumber - （可选）默认是自动，交易可使用的gas，未使用的gas会退回。</li>
<li>gasPrice: Number|String|BigNumber - （可选）默认是自动确定，交易的gas价格，默认是网络gas价格的平均值 。</li>
<li>data: String - （可选）或者包含相关数据的字节字符串，如果是合约创建，则是初始化要用到的代码。</li>
<li>nonce: Number - （可选）整数，使用此值，可以允许你覆盖你自己的相同nonce的，正在pending中的交易11。</li>
<li>Function - 回调函数，用于支持异步的方式执行7。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">返回值：</span><br><span class="line">String - 32字节的交易哈希串。用16进制表示。</span><br><span class="line">fullhash=0x542fbb5848724a5ef7511ee2503d10c0180bd0b9eed5dd7a175bb84375250f09 recipient=0x5Bc642Cd76Bf742ef3d202824e1d258942205218</span><br><span class="line">fullhash 是交易哈希，recipient 是合约地址。</span><br></pre></td></tr></table></figure>
<p>上面参数中的 gas 就是你指定的燃料。即你愿意为该交易支付多少燃料。如果燃料不足以支撑交易的执行，那么该交易会回滚。如果交易未耗完燃料，剩余的燃料会回退。如果燃料给的太多，超过了区块的燃料限制，也会被拒绝。区块的燃料限制就是 genesis.json 内的 gas limit 参数。这个参数指定了这个区块最多消耗这么多燃料。</p>
<ol start="3">
<li>对合约对象的属性的调用。</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">// Automatically determines the use of call or sendTransaction based on the method type</span><br><span class="line">myContractInstance.myMethod(param1 [, param2, ...][, transactionObject] [, defaultBlock][, callback]);</span><br><span class="line"></span><br><span class="line">// Explicitly calling this method</span><br><span class="line">myContractInstance.myMethod.call(param1 [, param2, ...] [, transactionObject] [, defaultBlock] [, callback]);</span><br><span class="line"></span><br><span class="line">// Explicitly sending a transaction to this method</span><br><span class="line">myContractInstance.myMethod.sendTransaction(param1 [, param2, ...] [, transactionObject] [, callback]);</span><br><span class="line"></span><br><span class="line">// Get the call data, so you can call the contract through some other means</span><br><span class="line">var myCallData = myContractInstance.myMethod.getData(param1 [, param2, ...]);</span><br><span class="line">// myCallData = &apos;0x45ff3ff6000000000004545345345345..&apos;</span><br></pre></td></tr></table></figure>
<p>合约对象内封装了使用合约的相关方法。可以通过传入参数，和交易对象来使用方法。</p>
<p>参数：</p>
<p>String|Number - （可选）零或多个函数参数。如果传入一个字符串，需要使用十六进制编码，如，0xdedbeef。<br>Object - （可选）最后一个参数（如果传了callback，则是倒数第二个参数），可以是一个交易对象。查看web3.eth.sendTransaction的第一个参数说明来了解更多。注意，这里不需要填data和to属性。<br>Number|String -（可选）如果不设置此值使用web3.eth.defaultBlock设定的块，否则使用指定的块。<br>Function -（可选）回调函数，用于支持异步的方式执行7。<br>返回值：</p>
<p>String - 如果发起的是一个 <code>call</code>，对应的是返回结果。如果是 <code>transaction</code>，则要么是一个创建的合约地址，或者是一个 <code>transaction</code> 的哈希值。查看 <code>web3.eth.sendTransaction</code> 了解更多。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">// creation of contract object</span><br><span class="line">var MyContract = web3.eth.contract(abi);</span><br><span class="line"></span><br><span class="line">// initiate contract for an address</span><br><span class="line">var myContractInstance = MyContract.at(&apos;0x78e97bcc5b5dd9ed228fed7a4887c0d7287344a9&apos;);</span><br><span class="line"></span><br><span class="line">var result = myContractInstance.myConstantMethod(&apos;myParam&apos;);</span><br><span class="line">console.log(result) // &apos;0x25434534534&apos;</span><br><span class="line"></span><br><span class="line">myContractInstance.myStateChangingMethod(&apos;someParam1&apos;, 23, &#123;value: 200, gas: 2000&#125;, function(err, result)&#123; ... &#125;);</span><br></pre></td></tr></table></figure>
<p>对于不会改变合约状态的合约函数的调用，直接使用 call 即可。</p>
<ol start="4">
<li>合约的事件 event 是什么? event 中的 indexed 是什么？</li>
</ol>
<p><a href="http://me.tryblockchain.org/blockchain-solidity-event.html" target="_blank" rel="noopener">Solidity的event事件（二十一）|入门系列</a></p>
<p><a href="http://me.tryblockchain.org/Blockchain-event-bestpractice.html" target="_blank" rel="noopener">Solidity的event的支持指引（二十二）|入门系列</a></p>
<ol start="5">
<li>modifier 是什么</li>
</ol>
<p>修饰器（Modifier）是一个简便的途径用来验证函数输入的有效性。类似于校验器，单独封装好，然后被方法调用。</p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/blockchain-ethereun-geth/" rel="tag"># blockchain ethereun geth</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/03/15/EOS-合约/" rel="next" title="EOS 合约">
                <i class="fa fa-chevron-left"></i> EOS 合约
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/03/26/智能合约最佳实践翻译四-软件工程技术/" rel="prev" title="智能合约最佳实践翻译四 - 软件工程技术">
                智能合约最佳实践翻译四 - 软件工程技术 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">John Doe</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">63</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">28</span>
                  <span class="site-state-item-name">标签</span>
                
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#安装"><span class="nav-number">1.</span> <span class="nav-text">安装</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#创世文件"><span class="nav-number">2.</span> <span class="nav-text">创世文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#写入创世区块。-修改了配置文件需要重新初始化创世块。"><span class="nav-number">3.</span> <span class="nav-text">写入创世区块。-修改了配置文件需要重新初始化创世块。</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#启动私有链节点"><span class="nav-number">4.</span> <span class="nav-text">启动私有链节点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#控制台操作"><span class="nav-number">5.</span> <span class="nav-text">控制台操作</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#创建账户"><span class="nav-number">5.1.</span> <span class="nav-text">创建账户</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#获取账户列表中第一个账户的资产"><span class="nav-number">5.2.</span> <span class="nav-text">获取账户列表中第一个账户的资产</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#启动-停止挖矿"><span class="nav-number">5.3.</span> <span class="nav-text">启动 / 停止挖矿</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#转账"><span class="nav-number">5.4.</span> <span class="nav-text">转账</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#查看交易"><span class="nav-number">6.</span> <span class="nav-text">查看交易</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#查看区块"><span class="nav-number">7.</span> <span class="nav-text">查看区块</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#连接其他节点"><span class="nav-number">8.</span> <span class="nav-text">连接其他节点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#智能合约"><span class="nav-number">9.</span> <span class="nav-text">智能合约</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#创建和编译智能合约"><span class="nav-number">9.1.</span> <span class="nav-text">创建和编译智能合约</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#部署智能合约"><span class="nav-number">9.2.</span> <span class="nav-text">部署智能合约</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#调用智能合约"><span class="nav-number">9.3.</span> <span class="nav-text">调用智能合约</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#小结"><span class="nav-number">9.4.</span> <span class="nav-text">小结</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#智能合约例子-投票选举"><span class="nav-number">10.</span> <span class="nav-text">智能合约例子 - 投票选举</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#创建合约脚本文件"><span class="nav-number">10.1.</span> <span class="nav-text">创建合约脚本文件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#部署合约"><span class="nav-number">10.2.</span> <span class="nav-text">部署合约</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#FAQ"><span class="nav-number">10.3.</span> <span class="nav-text">FAQ</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">John Doe</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
